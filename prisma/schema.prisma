generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialActions"]
}

datasource db {
  provider = "postgres"
  url      = "postgresql://shawn:@localhost:5432/appdb"
}

model User {
  id            Int       @id @default(autoincrement())
  firstName     String?
  lastName      String?
  name          String?
  email         String?   @unique
  emailVerified DateTime? @map(name: "email_verified")
  image         String?
  addressId     Int?
  createdAt     DateTime  @default(now()) @map(name: "created_at")
  updatedAt     DateTime  @updatedAt @map(name: "updated_at")
  listings      Listing[]
  address       Address?  @relation(fields: [addressId], references: [id])
  profile       Profile?

  @@map(name: "users")
}

model Address {
  id        Int      @id @default(autoincrement())
  line1     String?
  line2     String?
  line3     String?
  line4     String?
  locality  String?
  postcode  String?
  countryId Int
  regionId  Int
  user      User[]
  country   Country  @relation(fields: [countryId], references: [id])
  region    Region   @relation(fields: [regionId], references: [id])
  createdAt DateTime @default(now()) @map(name: "created_at")
  updatedAt DateTime @default(now()) @map(name: "updated_at")
}

model Country {
  id      Int       @id @default(autoincrement())
  name    String
  code    String    @db.VarChar(2)
  region  Region[]
  Address Address[]
}

model Region {
  id        Int       @id @default(autoincrement())
  name      String
  code      String    @db.VarChar(2)
  countryId Int
  Country   Country   @relation(fields: [countryId], references: [id])
  Address   Address[]
}

model Profile {
  id     Int     @id @default(autoincrement())
  bio    String?
  userId Int     @unique
  user   User    @relation(fields: [userId], references: [id])
}

model Account {
  id                 Int       @id @default(autoincrement())
  compoundId         String    @unique @map(name: "compound_id")
  userId             Int       @map(name: "user_id")
  providerType       String    @map(name: "provider_type")
  providerId         String    @map(name: "provider_id")
  providerAccountId  String    @map(name: "provider_account_id")
  refreshToken       String?   @map(name: "refresh_token")
  accessToken        String?   @map(name: "access_token")
  accessTokenExpires DateTime? @map(name: "access_token_expires")
  createdAt          DateTime  @default(now()) @map(name: "created_at")
  updatedAt          DateTime  @default(now()) @map(name: "updated_at")


  @@index([providerAccountId], name: "providerAccountId")
  @@index([providerId], name: "providerId")
  @@index([userId], name: "userId")
  @@map(name: "accounts")
}

model Session {
  id           Int      @id @default(autoincrement())
  userId       Int      @map(name: "user_id")
  expires      DateTime
  sessionToken String   @unique @map(name: "session_token")
  accessToken  String   @unique @map(name: "access_token")
  createdAt    DateTime @default(now()) @map(name: "created_at")
  updatedAt    DateTime @default(now()) @map(name: "updated_at")

  @@map(name: "sessions")
}

model VerificationRequest {
  id         Int      @id @default(autoincrement())
  identifier String
  token      String   @unique
  expires    DateTime
  createdAt  DateTime @default(now()) @map(name: "created_at")
  updatedAt  DateTime @default(now()) @map(name: "updated_at")

  @@map(name: "verification_requests")
}

model Listing {
  id                Int                  @id @default(autoincrement())
  title             String
  image             String[]
  published         Boolean              @default(false)
  userId            Int
  listingId         Int
  createdAt         DateTime             @default(now()) @map(name: "created_at")
  updatedAt         DateTime             @default(now()) @map(name: "updated_at")
  categoryId        Int
  user              User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  listingInfomation ListingInformation[]
  Category          Category[]
}

model ListingInformation {
  id             Int          @id @default(autoincrement())
  price          Decimal      @db.Money
  description    String
  listingId      Int
  manufacturerId Int
  mediumId       Int
  createdAt      DateTime     @default(now()) @map(name: "created_at")
  updatedAt      DateTime     @default(now()) @map(name: "updated")
  listing        Listing      @relation(fields: [listingId], references: [id])
  manufacturer   Manufacturer @relation(fields: [manufacturerId], references: [id])
  medium         Medium       @relation(fields: [mediumId], references: [id])
}

model Manufacturer {
  id                 Int                  @id @default(autoincrement())
  name               String
  createdAt          DateTime             @default(now()) @map(name: "created_at")
  updatedAt          DateTime             @default(now()) @map(name: "updated")
  listingInformation ListingInformation[]
}

model Grade {
  id        Int      @id @default(autoincrement())
  grade     String
  graderId  Int
  createdAt DateTime @default(now()) @map(name: "created_at")
  updatedAt DateTime @default(now()) @map(name: "updated")
  Grader    Grader   @relation(fields: [graderId], references: [id])
}

model Grader {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime @default(now()) @map(name: "created_at")
  updatedAt DateTime @default(now()) @map(name: "updated")
  grade     Grade[]
}

model Medium {
  id                 Int                 @id @default(autoincrement())
  type               String
  createdAt          DateTime            @default(now()) @map(name: "created_at")
  updatedAt          DateTime            @default(now()) @map(name: "updated")
  listingInformation ListingInformation?
}

model Category {
  id        Int        @id @default(autoincrement())
  name      String
  parentId  Int
  listingId Int
  typeId    Int
  rarityId  Int
  artistId  Int
  setId     Int
  createdAt DateTime   @default(now()) @map(name: "created_at")
  updatedAt DateTime   @default(now()) @map(name: "updated")
  children  Category[] @relation("SubCategories")
  parent    Category   @relation("SubCategories", fields: [parentId], references: [id])
  Listing   Listing?   @relation(fields: [listingId], references: [id])
  Type      Type?      @relation(fields: [typeId], references: [id])
  Rarity    Rarity?    @relation(fields: [rarityId], references: [id])
  Artist    Artist?    @relation(fields: [artistId], references: [id])
  Set       Set?       @relation(fields: [setId], references: [id])

  @@unique([name])
}

model Card {
  id              String   @id @default(uuid())
  name            String
  universalId     Int
  imageUrl        String
  text            String?
  layout          String?
  collectorNumber String?
  printing        String[]
  typeId          Int
  rarityId        Int
  createdAt       DateTime @default(now()) @map(name: "created_at")
  updatedAt       DateTime @default(now()) @map(name: "updated")
  universalType   Type     @relation("UniversalType", fields: [typeId], references: [id])
  types           Type[]
  rarity          Rarity   @relation(fields: [rarityId], references: [id])
}

model Type {
  id            Int        @id @default(autoincrement())
  name          String
  categoryId    Int
  createdAt     DateTime   @default(now()) @map(name: "created_at")
  updatedAt     DateTime   @default(now()) @map(name: "updated")
  cardSuperType Card?      @relation("UniversalType")
  category      Category[]
  card          Card[]
}

model Rarity {
  id         Int        @id @default(autoincrement())
  name       String
  categoryId Int
  createdAt  DateTime   @default(now()) @map(name: "created_at")
  updatedAt  DateTime   @default(now()) @map(name: "updated")
  category   Category[]
  Card       Card[]
}

model Artist {
  id         Int        @id @default(autoincrement())
  name       String
  categoryId Int
  createdAt  DateTime   @default(now()) @map(name: "created_at")
  updatedAt  DateTime   @default(now()) @map(name: "updated")
  category   Category[]
}

model Set {
  id         Int        @id @default(autoincrement())
  name       String
  categoryId Int
  createdAt  DateTime   @default(now()) @map(name: "created_at")
  updatedAt  DateTime   @default(now()) @map(name: "updated")
  category   Category[]
}
